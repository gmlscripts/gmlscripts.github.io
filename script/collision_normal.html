<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>GMLscripts.com :: collision_normal</title>
<meta name="theme-color" content="#FC7C13">
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" title="GMLscripts.com :: Script Commit History" href="https://github.com/gmlscripts/scripts/commits/master.atom" type="application/rss+xml" />
<script type="text/x-mathjax-config">//<![CDATA[
MathJax.Hub.Config({extensions:["tex2jax.js"],jax:["input/TeX","output/HTML-CSS"],tex2jax:{inlineMath:[["\\(","\\)"],['[tex]','[/tex]']],displayMath:[['$$','$$'],["\\[","\\]"]],processEscapes:true},"HTML-CSS":{availableFonts:["TeX"]},menuSettings:{zoom:"Click"},MathZoom:{styles:{"#MathJax_Zoom":{"background-color":"#222","box-shadow":"0px 0px 15px #AAAAAA","-webkit-box-shadow":"0px 0px 15px #AAAAAA","-moz-box-shadow":"0px 0px 15px #AAAAAA","-khtml-box-shadow":"0px 0px 15px #AAAAAA",}}}});
MathJax.Hub.Queue(function () { showMathJax(); } );//]]></script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript">var scripts = "collision_normal"</script>
<script type="text/javascript">var locals = "parent, list";</script>
<script type="text/javascript" src="../prettify/prettify.js"></script>
<script type="text/javascript" src="../prettify/lang-gml.js"></script>
<script type="text/javascript" src="../gmlscripts35.js"></script>
<link rel="stylesheet" type="text/css" href="../gmlscripts35.css" />
<link href="https://fonts.googleapis.com/css?family=Paytone+One%7CABeeZee%7CSource+Code+Pro" rel="stylesheet" />
</head>
<body onload="start();">
<noscript><div>JAVASCRIPT REQUIRED</div></noscript>
<p class="static">You are currently viewing the <a href="../index.html">GMLscripts.com</a> static mirror. Forum access and script submissions are not available through this mirror.</p>
<header>
  <img id="contrast" src="../images/35/_note.png" title="Invert" alt="Invert" />
  <a href="../index.html" id="home"><img src="../images/35/gmlscripts-header3d.png" alt="GMLscripts.com" /></a>
  <nav id="headnav">
    <ul><li>
      <a href="index.html">Scripts</a></li><li>
      <a href="collision_normal.html#">Forums</a></li><li>
      <a href="../license.html">License</a></li><li>
      <a href="collision_normal.html#">Search</a></li><li>
      <a href="collision_normal.html#">Submit</a></li><li>
      <a href="../paypal.html">Donate</a></li><li>
      <a href="collision_normal.html#">Releases</a></li><li>
      <a href="http://twitter.com/gmlscripts">Follow</a></li>
    </ul>
  </nav>
</header>
<nav id="sidenav">
<div>
  <span>Scripts</span>
  <ul class="accordion" id="Scripts">
    <li id="computation" class="computation">
      <a href="collision_normal.html#computation">Computation</a>
      <ul>
        <li><a href="Computation/Base_Conversion/index.html">Base Conversion</a></li>
        <li><a href="Computation/Bitwise/index.html">Bitwise</a></li>
        <li><a href="Computation/Data_Encoding/index.html">Data Encoding</a></li>
        <li><a href="Computation/Data_Encryption/index.html">Data Encryption</a></li>
        <li><a href="Computation/Data_Hashing/index.html">Data Hashing</a></li>
        <li><a href="Computation/Date-Time/index.html">Date-Time</a></li>
        <li><a href="Computation/Geometry/index.html">Geometry</a></li>
        <li><a href="Computation/Parametric_Functions/index.html">Parametric Functions</a></li>
        <li><a href="Computation/Probability/index.html">Probability</a></li>
        <li><a href="Computation/Real_Numbers/index.html">Real Numbers</a></li>
        <li><a href="Computation/Strings/index.html">Strings</a></li>
      </ul>
    </li>
    <li id="data_structures" class="data_structures">
      <a href="collision_normal.html#data_structures">Data Structures</a>
      <ul>
        <li><a href="Data_Structures/Arrays/index.html">Arrays</a></li>
        <li><a href="Data_Structures/Grids/index.html">Grids</a></li>
        <li><a href="Data_Structures/Lists/index.html">Lists</a></li>
        <li><a href="Data_Structures/Maps/index.html">Maps</a></li>
      </ul>
    </li>
    <li id="files" class="files">
      <a href="collision_normal.html#files">Files</a>
      <ul>
        <li><a href="Files/Input_and_Output/index.html">Input and Output</a></li>
      </ul>
    </li>
    <li id="game_play" class="game_play">
      <a href="collision_normal.html#game_play">Game Play</a>
      <ul>
        <li><a href="Game_Play/Artificial_Intelligence/index.html">Artificial Intelligence</a></li>
        <li><a href="Game_Play/Collisions/index.html">Collisions</a></li>
        <li><a href="Game_Play/Instances/index.html">Instances</a></li>
        <li><a href="Game_Play/Movement/index.html">Movement</a></li>
      </ul>
    </li>
    <li id="graphics" class="graphics">
      <a href="collision_normal.html#graphics">Graphics</a>
      <ul>
        <li><a href="Graphics/3D/index.html">3D</a></li>
        <li><a href="Graphics/Backgrounds/index.html">Backgrounds</a></li>
        <li><a href="Graphics/Color/index.html">Color</a></li>
        <li><a href="Graphics/Drawing/index.html">Drawing</a></li>
        <li><a href="Graphics/Shaders/index.html">Shaders</a></li>
        <li><a href="Graphics/Sprites/index.html">Sprites</a></li>
        <li><a href="Graphics/Surfaces/index.html">Surfaces</a></li>
        <li><a href="Graphics/Text/index.html">Text</a></li>
      </ul>
    </li>
    <li id="interaction" class="interaction">
      <a href="collision_normal.html#interaction">Interaction</a>
      <ul>
        <li><a href="Interaction/Gamepad/index.html">Gamepad</a></li>
        <li><a href="Interaction/Mouse/index.html">Mouse</a></li>
      </ul>
    </li>
    <li id="platform" class="platform">
      <a href="collision_normal.html#platform">Platform</a>
      <ul>
        <li><a href="Platform/Device/index.html">Device</a></li>
      </ul>
    </li>
    <li id="resources" class="resources">
      <a href="collision_normal.html#resources">Resources</a>
      <ul>
        <li><a href="Resources/Management/index.html">Management</a></li>
        <li><a href="Resources/Sprites/index.html">Sprites</a></li>
      </ul>
    </li>
  </ul>
  <span></span>
</div>
</nav>
<main>
<h1>collision_normal</h1>
<p><img style="float:right" src="../images/collision_normal.png" alt="collision_normal() sampler" title="collision_normal() sampler" /></p>
<p>The purpose of this script is to determine what direction the sprite of
an instance is facing at a particular point on or near the sprite,
ie. a 2D analogue of a surface normal.</p>
<p>It does this by sampling an area around a given point. As each point is
sampled, if there is no collision, a vector is generated from the center
of the sample area to the sampled point. These vectors are summed to
produce an overall directional vector pointing away from any detected
surface within the sampled area.</p>
<p>Sampling can be quite intensive for even modest sized areas. Use the
<code>spacing</code> argument to reduce the number of samples.</p>
<div class="codebox demo"><span>Move cursor near surfaces to see surface normal. Click to create bouncing ball.<iframe frameborder="0" scrolling="no" width="512" height="256" src="/demos/collision_normal/index.html"></iframe><a href="/demos/collision_normal/collision_normal.yyz">Download</a></span></div>
<dl class="dictionary script">
<dt><a href="collision_normal.html">collision_normal(x, y, obj, radius, spacing)</a></dt>
<dd>Returns a 2D &quot;surface normal&quot; at a point on or near an instance within a test area.</dd>
</dl>
<div class="codebox script">
<pre><span class="copy"><a title="Copy to Clipboard" onclick="copyUpdate(this,copyToClipboard('collision_normal'))">COPY</a></span><code class="prettyprint lang-gml linenums" id="collision_normal">/// @func   collision_normal(x, y, obj, radius, spacing)
///
/// @desc   Returns a 2D "surface normal" at a point on or near an
///         instance within a test area. The test area is circular
///         and the detected normal direction is returned in degrees.
///         If no collision is found, (-1) is returned. Uses about
///         pi*(radius*radius)/(spacing*spacing) collision checks.
///
/// @param  {real}      x           x-coordinate of point near an instance
/// @param  {real}      y           y-coordinate of point near an instance
/// @param  {object}    obj         object or instance (or all)
/// @param  {real}      radius      radius of test area (default 4)
/// @param  {real}      spacing     space between each sample (default 1)
///
/// @return {real}      direction pointing away from the detected surface
///
/// GMLscripts.com/license

function collision_normal(x, y, obj, radius=4, spacing=1)
{
    var nx = 0;
    var ny = 0;
    if (collision_circle(x, y, radius, obj, true, true) != noone) {
        for (var j=spacing; j&lt;=radius; j+=spacing) {
            for (var i=0; i&lt;radius; i+=spacing) {
                if (point_distance(0, 0, i, j) &lt;= radius) {
                    if (collision_point(x+i, y+j, obj, true, true) == noone) { nx += i; ny += j; }
                    if (collision_point(x+j, y-i, obj, true, true) == noone) { nx += j; ny -= i; }
                    if (collision_point(x-i, y-j, obj, true, true) == noone) { nx -= i; ny -= j; }
                    if (collision_point(x-j, y+i, obj, true, true) == noone) { nx -= j; ny += i; }
                }
            }
        }
        if (nx == 0 &amp;&amp; ny == 0) return (-1);
        return point_direction(0, 0, nx, ny);
    }
    return (-1);
}
</code></pre>
</div>
<p id="contributors">
Contributors: xot, strawbryjam
</p>
<p id="related">
Related: <a href="collision_line_first.html">collision_line_first</a>, <strong>collision_normal</strong>, <a href="collision_triangle.html">collision_triangle</a>, <a href="range_finder.html">range_finder</a>
</p>
<p id="github">
GitHub: <a href="https://github.com/gmlscripts/scripts/blob/master/Game_Play/Collisions/collision_normal.gml" target="_blank">View</a>  &middot; <a href="https://github.com/gmlscripts/scripts/commits/master/Game_Play/Collisions/collision_normal.gml" target="_blank">Commits</a>  &middot; <a href="https://github.com/gmlscripts/scripts/blame/master/Game_Play/Collisions/collision_normal.gml" target="_blank">Blame</a> &middot; <a href="https://github.com/gmlscripts/scripts/raw/master/Game_Play/Collisions/collision_normal.gml" target="_blank">Raw</a>
</p>
<hr />
<!-- DISQUS START -->
<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
this.page.url = 'https://www.gmlscripts.com/script/collision_normal';
this.page.identifier = '/script/collision_normal';
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://gmlscripts.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!-- DISQUS END -->
</main>
<footer>
  copyright &copy; 2007-2024, xot media multimixing 
  <span><img src="../images/35/x.png" title="web by xot" alt="X" /></span>
  <div id="cookies">This site uses cookies to improve navigation and to log into our forums. By continuing to use this site, you agree to the use of cookies.<a id="cookiebutton">OK</a></div>
</footer>
</body>
</html>
