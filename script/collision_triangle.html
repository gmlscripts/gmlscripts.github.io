<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>GMLscripts.com :: collision_triangle</title>
<link rel="icon" type="image/gif" href="../favicon.gif" />
<link rel="alternate" title="GMLscripts.com :: Script Commit History" href="https://github.com/gmlscripts/scripts/commits/master.atom" type="application/rss+xml" />
<link rel="alternate" title="GMLscripts.com :: Forum Posts" href="/forums/rss.xml" type="application/rss+xml" />
<script type="text/x-mathjax-config">//<![CDATA[
MathJax.Hub.Config({extensions:["tex2jax.js"],jax:["input/TeX","output/HTML-CSS"],tex2jax:{inlineMath:[["\\(","\\)"],['[tex]','[/tex]']],displayMath:[['$$','$$'],["\\[","\\]"]],processEscapes:true},"HTML-CSS":{availableFonts:["TeX"]},MathZoom:{styles:{"#MathJax_Zoom":{"background-color":"#222","box-shadow":"0px 0px 15px #AAAAAA","-webkit-box-shadow":"0px 0px 15px #AAAAAA","-moz-box-shadow":"0px 0px 15px #AAAAAA","-khtml-box-shadow":"0px 0px 15px #AAAAAA",}}}});
MathJax.Hub.Queue(function () { $(".mathjax").fadeIn();} );//]]></script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="../jquery.min.js"></script>
<script type="text/javascript" src="../prettify/prettify.js"></script>
<script type="text/javascript" src="../prettify/lang-gml.js"></script>
<script type="text/javascript" src="../cookie.js"></script>
<script type="text/javascript" src="../contrast.js"></script>
<script type="text/javascript" src="../accordionmenu.js"></script>
<link rel="stylesheet" type="text/css" href="../prettify/prettify.css" />
<link rel="stylesheet" type="text/css" href="../contrast.css" />
<link rel="stylesheet" type="text/css" href="../accordionmenu30.css" />
<link rel="stylesheet" type="text/css" href="../gmlscripts30.css" />
</head>
<body >
<noscript><div>JAVASCRIPT REQUIRED</div></noscript>
<p style="background-color: #622; padding: 1em; border: 2px solid; font-weight: bold;">You are currently viewing the <a href="index.html">GMLscripts.com</a> static mirror because there is a problem with normal hosting. That problem is a lack of money. This mirror is up-to-date but is functionally limited. The forums are unavailable and new submissions are not possible. <a href="paypal.html">Donations</a> are gratefully accepted to help get things back to normal. Sorry for the temporary inconvenience.</p>
<!-- Header -->
<div id="header">
    <img id="contrast" src="../images/30/_note.png" title="Invert" alt="Invert" />
    <div class="header-left"></div>
    <div class="header-right">
        <a href="../index.html" id="home"><img src="../images/30/gmlscripts-header3b.gif" alt="GMLscripts.com" /></a><br />
        <a href="index.html" class="nav">Scripts</a><a href="../#" class="nav">Forums</a><a href="../license.html" class="nav">License</a><a href="../search.html" class="nav">Search</a><a href="../#" class="nav">Submit</a><a href="../paypal.html" class="nav">Donate</a><a href="../#" class="nav">Releases</a><a href="http://twitter.com/gmlscripts" class="nav">Follow</a>
    </div>
</div>

<!-- Main column -->
<div id="container">
    <div id="content">
        <!-- start roundcorners -->
        <div class="top-left"></div>
        <div class="top-right"></div>
        <div class="inside">
<h1>collision_triangle</h1>
<p class="warning"><span>WARNING:</span> Due to the obsolescence of <code>object_add()</code> and <code>object_add_event()</code>,
some or all of the work done by the script <code>collision_triangle_init()</code>
will have to be done manually.</p>
<p>This script works similarly to built-in <code>collision_*()</code> functions. It uses
a right-triangle-shaped sprite mask to detect collisions with pixel accuracy
(unlike other simpler and faster methods). Because any triangle can be split
into two right triangles, the script can manipulate this single collision mask
to fit any triangle using only scaling and rotation.</p>
<p><img src="../images/collision_triangle.gif" alt="collision_triangle" title="collision triangle" /></p>
<p class="note"><span>NOTE:</span> This script will eventually be replaced with a version that works more
like the built-in <code>collision_*()</code> functions of GameMaker:Studio. It will return
an instance id rather than the true or false value it returns now.</p>
<dl class="dictionary script">
<dt><a href="collision_triangle.html">collision_triangle(x1,y1,x2,y2,x3,y3,object)</a></dt>
<dd>Returns true if there is a collision between a given triangle and a given object, false otherwise.</dd>
</dl>
<div class="codebox script">
<pre><code class="prettyprint lang-gml">/// collision_triangle(x1,y1,x2,y2,x3,y3,object)
//
//  Returns true if there is a collision between a given
//  triangle and a given object, false otherwise.
//
//  NOTE: Initialize with collision_triangle_init() before first use.
//
//      x1,y1       first point of triangle (filled), real
//      x2,y2       second point of triangle (filled), real
//      x3,y3       third point of triangle (filled), real
//      object      object or instance (or all), real
//
/// GMLscripts.com/license
{
   var x1,y1,x2,y2,x3,y3,object,xmin,xmax,ymin,ymax,d12,d13,d23,d14,d24,t,dx,dy,x4,y4;
   x1 = argument0;
   y1 = argument1;
   x2 = argument2;
   y2 = argument3;
   x3 = argument4;
   y3 = argument5;
   object = argument6;

   // Bounding box check
   xmin = min(x1,x2,x3);
   xmax = max(x1,x2,x3);
   ymin = min(y1,y2,y3);
   ymax = max(y1,y2,y3);
   if (not collision_rectangle(xmin,ymin,xmax,ymax,object,false,false)) return false;

   // Triangle perimeter check
   if (collision_line(x1,y1,x2,y2,object,true,false)) return true;
   if (collision_line(x1,y1,x3,y3,object,true,false)) return true;
   if (collision_line(x2,y2,x3,y3,object,true,false)) return true;

   // Find long side, make it (x1,y2) to (x2,y2)
   d12 = point_distance(x1,y1,x2,y2);
   d13 = point_distance(x1,y1,x3,y3);
   d23 = point_distance(x2,y2,x3,y3);
   switch (max(d12,d13,d23)) {
       case d13:
           t = x2; x2 = x3; x3 = t;
           t = y2; y2 = y3; y3 = t;
           d12 = d13;
           break;
       case d23:
           t = x1; x1 = x3; x3 = t;
           t = y1; y1 = y3; y3 = t;
           d12 = d23;
           break;
   }

   // From (x3,y3), find nearest point on long side (x4,y4).
   dx = x2 - x1;
   dy = y2 - y1;
   if ((dx == 0) &amp;&amp; (dy == 0)) {
       x4 = x1;
       y4 = y1;
   }else{
       t = ((x3 - x1) * dx + (y3 - y1) * dy) / (d12 * d12);
       x4 = x1 + t * dx;
       y4 = y1 + t * dy;
   }

   // A line constructed from (x3,y3) to (x4,y4) divides
   // the original triangle into two right triangles.
   // Fit the collision mask into these triangles.
   d14 = point_distance(x1,y1,x4,y4);
   d24 = d12 - d14;
   with (global.objCollisionTriangle) {
       image_angle  = point_direction(x1,y1,x4,y4);
       image_xscale = d14 / size;
       image_yscale = point_distance(x3,y3,x4,y4) / size;
       if ((x1 &gt; x4) xor (y3 &lt; y4)) image_yscale *= -1;
       if (place_meeting(x4,y4,object)) return true;
       image_xscale = -d24 / size;
       if (place_meeting(x4,y4,object)) return true;
   }
   return false;
}
</code></pre>
</div>
<dl class="dictionary script">
<dt><a href="collision_triangle_init.html">collision_triangle_init(size)</a></dt>
<dd>Required to initialize collision_triangle() before first use.</dd>
</dl>
<div class="codebox script">
<pre><code class="prettyprint lang-gml">/// collision_triangle_init(size)
//
//  Required to initialize collision_triangle() before first use. Creates
//  an object, sprite, and global variable __objCollisionTriangle. A large
//  test triangle improves accuracy at the expense of memory usage.
//
//      size        size of test triangle in pixels, real
//
/// GMLscripts.com/license
{
    if (not variable_global_exists("objCollisionTriangle")) {
        var color,object,size;
        size = argument0;
        object = object_add();
        object_set_persistent(object,true);
        object_event_add(object,ev_create,0,"size = "+string(size));
        global.objCollisionTriangle = instance_create(0,0,object);
        draw_clear_alpha(c_black,1);
        color = draw_get_color();
        draw_set_color(c_white);
        draw_triangle(size,size,size,0,0,0,false);
        draw_set_color(color);
        global.objCollisionTriangle.sprite_index = 
        sprite_create_from_screen(0,0,size,size,true,true,false,true,size,0);
        global.objCollisionTriangle.visible = false;
    }
}
</code></pre>
</div>
<p id="contributors">
Contributors: xot
</p>
<p id="related">
Related: <a href="collision_circle_list.html">collision_circle_list</a>, <a href="collision_ellipse_list.html">collision_ellipse_list</a>, <a href="collision_line_first.html">collision_line_first</a>, <a href="collision_line_list.html">collision_line_list</a>, <a href="collision_normal.html">collision_normal</a>, <a href="collision_point_list.html">collision_point_list</a>, <a href="collision_rectangle_list.html">collision_rectangle_list</a>, <strong>collision_triangle</strong>, <a href="instance_place_list.html">instance_place_list</a>, <a href="range_finder.html">range_finder</a>
</p>
<p id="github">
GitHub: <a href="https://github.com/gmlscripts/scripts/blob/master/Game_Play/Collisions/collision_triangle.gml" target="_blank">View</a>  &middot; <a href="https://github.com/gmlscripts/scripts/commits/master/Game_Play/Collisions/collision_triangle.gml" target="_blank">Commits</a>  &middot; <a href="https://github.com/gmlscripts/scripts/blame/master/Game_Play/Collisions/collision_triangle.gml" target="_blank">Blame</a> &middot; <a href="https://github.com/gmlscripts/scripts/raw/master/Game_Play/Collisions/collision_triangle.gml" target="_blank">Raw</a>
</p>

<!--

collision_triangle
==================

Warning: Due to the obsolescence of `object_add()` and `object_add_event()`,
some or all of the work done by the script `collision_triangle_init()` 
will have to be done manually.

This script works similarly to built-in `collision_*()` functions. It uses 
a right-triangle-shaped sprite mask to detect collisions with pixel accuracy 
(unlike other simpler and faster methods). Because any triangle can be split 
into two right triangles, the script can manipulate this single collision mask 
to fit any triangle using only scaling and rotation.

![collision_triangle](/images/collision_triangle.gif "collision triangle")

Note: This script will eventually be replaced with a version that works more 
like the built-in `collision_*()` functions of GameMaker:Studio. It will return 
an instance id rather than the true or false value it returns now.

collision_triangle(x1,y1,x2,y2,x3,y3,object)
:   Returns true if there is a collision between a given triangle and a given object, false otherwise.

````````````````````````````````````````````````````````````````````````````
/// collision_triangle(x1,y1,x2,y2,x3,y3,object)
//
//  Returns true if there is a collision between a given
//  triangle and a given object, false otherwise.
//
//  NOTE: Initialize with collision_triangle_init() before first use.
//
//      x1,y1       first point of triangle (filled), real
//      x2,y2       second point of triangle (filled), real
//      x3,y3       third point of triangle (filled), real
//      object      object or instance (or all), real
//
/// GMLscripts.com/license
{
   var x1,y1,x2,y2,x3,y3,object,xmin,xmax,ymin,ymax,d12,d13,d23,d14,d24,t,dx,dy,x4,y4;
   x1 = argument0;
   y1 = argument1;
   x2 = argument2;
   y2 = argument3;
   x3 = argument4;
   y3 = argument5;
   object = argument6;
   
   // Bounding box check
   xmin = min(x1,x2,x3);
   xmax = max(x1,x2,x3);
   ymin = min(y1,y2,y3);
   ymax = max(y1,y2,y3);
   if (not collision_rectangle(xmin,ymin,xmax,ymax,object,false,false)) return false;
   
   // Triangle perimeter check
   if (collision_line(x1,y1,x2,y2,object,true,false)) return true;
   if (collision_line(x1,y1,x3,y3,object,true,false)) return true;
   if (collision_line(x2,y2,x3,y3,object,true,false)) return true;

   // Find long side, make it (x1,y2) to (x2,y2)
   d12 = point_distance(x1,y1,x2,y2);
   d13 = point_distance(x1,y1,x3,y3);
   d23 = point_distance(x2,y2,x3,y3);
   switch (max(d12,d13,d23)) {
       case d13:
           t = x2; x2 = x3; x3 = t;
           t = y2; y2 = y3; y3 = t;
           d12 = d13;
           break;
       case d23:
           t = x1; x1 = x3; x3 = t;
           t = y1; y1 = y3; y3 = t;
           d12 = d23;
           break;
   }
   
   // From (x3,y3), find nearest point on long side (x4,y4).
   dx = x2 - x1;
   dy = y2 - y1;
   if ((dx == 0) && (dy == 0)) {
       x4 = x1;
       y4 = y1;
   }else{
       t = ((x3 - x1) * dx + (y3 - y1) * dy) / (d12 * d12);
       x4 = x1 + t * dx;
       y4 = y1 + t * dy;
   }
   
   // A line constructed from (x3,y3) to (x4,y4) divides
   // the original triangle into two right triangles.
   // Fit the collision mask into these triangles.
   d14 = point_distance(x1,y1,x4,y4);
   d24 = d12 - d14;
   with (global.objCollisionTriangle) {
       image_angle  = point_direction(x1,y1,x4,y4);
       image_xscale = d14 / size;
       image_yscale = point_distance(x3,y3,x4,y4) / size;
       if ((x1 > x4) xor (y3 < y4)) image_yscale *= -1;
       if (place_meeting(x4,y4,object)) return true;
       image_xscale = -d24 / size;
       if (place_meeting(x4,y4,object)) return true;
   }
   return false;
}

````````````````````````````````````````````````````````````````````````````

collision_triangle_init(size)
:   Required to initialize collision_triangle() before first use.

````````````````````````````````````````````````````````````````````````````
/// collision_triangle_init(size)
//
//  Required to initialize collision_triangle() before first use. Creates
//  an object, sprite, and global variable __objCollisionTriangle. A large
//  test triangle improves accuracy at the expense of memory usage.
//
//      size        size of test triangle in pixels, real
//
/// GMLscripts.com/license
{
    if (not variable_global_exists("objCollisionTriangle")) {
        var color,object,size;
        size = argument0;
        object = object_add();
        object_set_persistent(object,true);
        object_event_add(object,ev_create,0,"size = "+string(size));
        global.objCollisionTriangle = instance_create(0,0,object);
        draw_clear_alpha(c_black,1);
        color = draw_get_color();
        draw_set_color(c_white);
        draw_triangle(size,size,size,0,0,0,false);
        draw_set_color(color);
        global.objCollisionTriangle.sprite_index = 
        sprite_create_from_screen(0,0,size,size,true,true,false,true,size,0);
        global.objCollisionTriangle.visible = false;
    }
}

````````````````````````````````````````````````````````````````````````````

contributors: xot


-->
<hr />
<!-- DISQUS START -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'gmlscripts'; // required: replace example with your forum shortname
    var disqus_identifier = '/script/collision_triangle';
    var disqus_url = ''+disqus_identifier;
    
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!-- DISQUS END -->
            <p class="nobottomgap" style="font-size:1px;"></p>
        </div>
        <!-- finish roundcorners -->
        <div class="bottom-left"></div>
        <div class="bottom-right"></div>
    </div>
</div>
<!-- end of main column -->

<!-- Secondary column -->
<div id="sidebar">
    <div class="menu">
        <span class="menu-head">Scripts</span>
        <ul class="accordion" id="Scripts">
            <li id="computation" class="computation">
                <a href="collision_triangle.html#computation">Computation</a>
                <ul class="sub-menu" style="display: none;">
                    <li><a href="Computation/Base_Conversion/index.html">Base Conversion</a></li>
                    <li><a href="Computation/Bitwise/index.html">Bitwise</a></li>
                    <li><a href="Computation/Data_Encoding/index.html">Data Encoding</a></li>
                    <li><a href="Computation/Data_Encryption/index.html">Data Encryption</a></li>
                    <li><a href="Computation/Data_Hashing/index.html">Data Hashing</a></li>
                    <li><a href="Computation/Date-Time/index.html">Date-Time</a></li>
                    <li><a href="Computation/Geometry/index.html">Geometry</a></li>
                    <li><a href="Computation/Parametric_Functions/index.html">Parametric Functions</a></li>
                    <li><a href="Computation/Probability/index.html">Probability</a></li>
                    <li><a href="Computation/Real_Numbers/index.html">Real Numbers</a></li>
                    <li><a href="Computation/Strings/index.html">Strings</a></li>
                </ul>
            </li>
            <li id="data_structures" class="data_structures">
                <a href="collision_triangle.html#data_structures">Data Structures</a>
                <ul class="sub-menu" style="display: none;">
                    <li><a href="Data_Structures/Arrays/index.html">Arrays</a></li>
                    <li><a href="Data_Structures/Grids/index.html">Grids</a></li>
                    <li><a href="Data_Structures/Lists/index.html">Lists</a></li>
                    <li><a href="Data_Structures/Maps/index.html">Maps</a></li>
                </ul>
            </li>
            <li id="files" class="files">
                <a href="collision_triangle.html#files">Files</a>
                <ul class="sub-menu" style="display: none;">
                    <li><a href="Files/Input_and_Output/index.html">Input and Output</a></li>
                </ul>
            </li>
            <li id="game_play" class="game_play">
                <a href="collision_triangle.html#game_play">Game Play</a>
                <ul class="sub-menu" style="display: none;">
                    <li><a href="Game_Play/Artificial_Intelligence/index.html">Artificial Intelligence</a></li>
                    <li><a href="Game_Play/Collisions/index.html">Collisions</a></li>
                    <li><a href="Game_Play/Instances/index.html">Instances</a></li>
                    <li><a href="Game_Play/Movement/index.html">Movement</a></li>
                </ul>
            </li>
            <li id="graphics" class="graphics">
                <a href="collision_triangle.html#graphics">Graphics</a>
                <ul class="sub-menu" style="display: none;">
                    <li><a href="Graphics/3D/index.html">3D</a></li>
                    <li><a href="Graphics/Backgrounds/index.html">Backgrounds</a></li>
                    <li><a href="Graphics/Color/index.html">Color</a></li>
                    <li><a href="Graphics/Drawing/index.html">Drawing</a></li>
                    <li><a href="Graphics/Shaders/index.html">Shaders</a></li>
                    <li><a href="Graphics/Sprites/index.html">Sprites</a></li>
                    <li><a href="Graphics/Surfaces/index.html">Surfaces</a></li>
                    <li><a href="Graphics/Text/index.html">Text</a></li>
                </ul>
            </li>
            <li id="interaction" class="interaction">
                <a href="collision_triangle.html#interaction">Interaction</a>
                <ul class="sub-menu" style="display: none;">
                    <li><a href="Interaction/Gamepad/index.html">Gamepad</a></li>
                    <li><a href="Interaction/Mouse/index.html">Mouse</a></li>
                </ul>
            </li>
            <li id="resources" class="resources">
                <a href="collision_triangle.html#resources">Resources</a>
                <ul class="sub-menu" style="display: none;">
                    <li><a href="Resources/Management/index.html">Management</a></li>
                    <li><a href="Resources/Sprites/index.html">Sprites</a></li>
                </ul>
            </li>
        </ul>
        <span class="menu-foot"></span>
    </div>
</div>
<!-- end of secondary column -->

<!-- Footer -->
<div id="footer">
    <div class="footer-left"></div>
    <div class="footer-right"><a href="collision_triangle.html#" id="xot"><img title="web by xot" alt="X" src="../images/30/x.gif" width="22" height="22" style="border-width:0; padding-top:6px; float:right;" /></a><p>copyright &copy; 2007&#8211;2015, xot media multimixing</p></div>
</div>
<script type="text/javascript">prettyPrint();</script>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript"><!--
_uacct = "UA-103560-3";
urchinTracker();
// -->
</script>
<!-- DISQUS START -->
<script type="text/javascript">
//<![CDATA[
(function() {
	var links = document.getElementsByTagName('a');
	var query = '?';
	for(var i = 0; i < links.length; i++) {
	if(links[i].href.indexOf('#disqus_thread') >= 0) {
		query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
	}
	}
	document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/gmlscripts/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>
<!-- DISQUS END -->
</body>
</html>
